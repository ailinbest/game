# 🌈 彩虹消消乐 🌈

一个专为8岁小朋友设计的网页消消乐游戏，使用Python Flask后端和HTML/CSS/JavaScript前端开发。

## 🎮 游戏特色

- 🌈 **鲜艳的彩色界面**：6种明亮的颜色（红、蓝、绿、黄、紫、橙），适合小朋友
- 🎯 **简单易懂的操作**：点击选择，再点击交换，直观易学
- ✨ **精美的动画效果**：
  - 交换动画：平滑的方块交换效果
  - 金色高亮边框：清楚标注符合消除规则的方块
  - 消除动画：炫酷的缩放消失效果
  - 连锁提示：显示 "🔥 连锁 X 🔥" 让玩家更有成就感
- 🎉 **庆祝动画**：成功消除时的彩色纸屑效果
- 💡 **智能提示系统**：随机显示游戏技巧
- 📱 **响应式设计**：支持手机和电脑，自适应屏幕大小
- 🔗 **连锁消除可视化**：每一轮连锁单独显示，方便理解游戏规则

## 🎯 游戏规则

### 基本规则
1. **目标**：把3个或更多相同颜色的方块排成一排（横向或纵向）来消除它们
2. **操作方法**：
   - 第一步：点击一个方块选中它（会显示白色边框）
   - 第二步：点击相邻的方块进行交换
   - 第三步：如果交换后能形成3个或以上相同颜色的连线，就会消除并得分！

### 消除规则
- ✅ **有效消除**：横向或纵向连续3个或以上相同颜色
- ❌ **无效移动**：交换后无法形成有效消除的移动会被拒绝
- 🔥 **连锁反应**：消除后方块下落，可能触发新的匹配，形成连锁！

### 得分规则
- 每消除一个方块得 **10分**
- 连锁消除会累积更多分数
- 尽可能制造连锁反应获得高分！

## 🎨 视觉效果

### 动画时间轴
1. **交换动画**（0.5秒）：两个方块交换位置
2. **金色高亮**（0.35秒）：符合规则的方块显示金色边框和脉动效果
3. **消除动画**（0.35秒）：方块缩放消失
4. **下落动画**：新方块从顶部落下填充空位
5. **连锁循环**：如果有新的匹配，重复上述过程

每轮连锁约 **1秒**，节奏适中，方便观察和理解。

## 🚀 如何运行

### 环境要求
- Python 3.7+
- Conda（推荐）或 virtualenv

### 安装步骤

1. **克隆或下载项目**
   ```bash
   cd /Users/renal/Work/personal-projects/game
   ```

2. **创建并激活虚拟环境**
   ```bash
   conda create -n game-env python=3.9
   conda activate game-env
   ```

3. **安装依赖**
   ```bash
   pip install -r requirements.txt
   ```

4. **运行游戏**
   ```bash
   python app.py
   ```

5. **打开浏览器**
   - 本地访问：`http://localhost:8081`
   - 局域网访问：`http://你的IP地址:8081`（例如：`http://192.168.1.53:8081`）

## 📁 项目结构

```
game/
├── app.py                 # Flask后端服务器
├── requirements.txt       # Python依赖包
├── README.md             # 项目说明文档
└── templates/
    └── index.html        # 游戏前端页面（HTML/CSS/JavaScript）
```

## 🛠️ 技术栈

### 后端
- **Flask**：轻量级Web框架
- **Flask-CORS**：处理跨域请求
- **Python**：游戏逻辑实现

### 前端
- **HTML5**：页面结构
- **CSS3**：样式和动画效果
- **JavaScript (ES6+)**：游戏交互逻辑
- **Fetch API**：与后端通信

## 🎮 游戏功能详解

### 核心功能

#### 1. 智能初始化
- 游戏开始时确保没有初始匹配
- 避免左边两个和上面两个相同颜色

#### 2. 匹配检测
- 实时检测横向和纵向的3连或以上匹配
- 支持复杂的匹配模式（L型、T型等）

#### 3. 连锁反应系统
- 自动检测消除后的新匹配
- 逐步显示每一轮连锁
- 金色边框清楚标注匹配方块

#### 4. 移动验证
- 只允许相邻方块交换（上下左右）
- 必须产生有效匹配才能交换
- 无效移动会给出友好提示

### 视觉反馈

#### 高亮效果
- **选中状态**：白色边框 + 放大效果
- **匹配高亮**：金色边框 + 多层发光 + 脉动动画
- **消除动画**：缩放消失效果

#### 提示消息
- **成功消除**：绿色渐变背景，显示消除数量
- **无效移动**：橙色渐变背景，友好提示
- **连锁提示**：红黄渐变背景，大号字体显示连锁数

## 🔧 开发说明

### API接口

#### 1. 获取游戏状态
```
GET /api/state
返回：{ board, score, moves }
```

#### 2. 创建新游戏
```
POST /api/new_game
返回：{ board, score, moves }
```

#### 3. 执行移动
```
POST /api/move
请求：{ from: [row, col], to: [row, col] }
返回：{
  success: boolean,
  matches: [[row, col], ...],
  board_after_swap: [...],
  chain_steps: [{
    matches: [...],
    board_before: [...],
    board_after_drop: [...]
  }],
  state: { board, score, moves }
}
```

### 核心类：MatchGame

```python
class MatchGame:
    def __init__(self, rows=8, cols=8)
    def init_board()                    # 初始化游戏板
    def find_matches()                  # 查找所有匹配
    def remove_matches(matches)         # 移除匹配的方块
    def drop_pieces()                   # 方块下落填充
    def is_valid_swap(...)              # 验证交换是否有效
    def make_move(...)                  # 执行移动并返回详细信息
    def get_state()                     # 获取当前游戏状态
```

## 🐛 已修复的问题

### 1. 乱消除问题（已修复）
- **问题**：匹配动画显示位置与实际方块不对应
- **原因**：前端显示匹配动画时，游戏板已经是最终状态
- **解决**：后端返回交换后的初始状态（`board_after_swap`），前端先显示该状态再播放匹配动画

### 2. 连锁消除不清晰（已优化）
- **问题**：连锁消除太快，看不清楚消除规则
- **原因**：所有匹配一次性处理，没有逐步显示
- **解决**：
  - 后端返回每一轮连锁的详细信息（`chain_steps`）
  - 前端逐步播放每一轮，用金色边框标注匹配方块
  - 显示连锁提示，增加成就感

## 📝 更新日志

### v1.2 (2025-10-25)
- ⚡ 优化连锁动画速度，每轮约1秒
- 🎨 调整动画时间参数，节奏更流畅

### v1.1 (2025-10-25)
- ✨ 新增连锁消除可视化功能
- 🌟 添加金色高亮边框标注匹配方块
- 🔥 显示连锁提示消息
- ⏱️ 放慢动画速度，方便观察

### v1.0 (2025-10-25)
- 🎉 初始版本发布
- 🐛 修复乱消除问题
- ✅ 完善游戏逻辑和动画效果

## 👨‍💻 作者

为8岁小朋友设计的趣味消消乐游戏

## 📄 许可证

本项目仅供学习和娱乐使用

---

**祝你玩得开心！🎮✨**
